package prf_test

import (
	"crypto/tls"
	"encoding/hex"
	"strings"
	"testing"

	"github.com/maxbet1507/eap/eaptls/capture/prf"
)

func TestPRF_TLS10(t *testing.T) {
	label := []byte("LABEL")
	secret := []byte("SECRET")
	seed := []byte("SEED")

	prf := prf.New(tls.VersionTLS10, 0)

	ret := make([]byte, 1024)
	prf(ret, secret, label, seed)

	chk := strings.Join([]string{
		"28471e018f06da6ffd6321040801f26e9a7cbfb63ce3c51523a488eb718787959cf2d88fd6306b236340221e11bbf859f3cb36fe008deef1379eaf8fa0d3b938",
		"f3607d5de48785d1b750651da59925189ef9dc006c1bdb78c8209d5098ac61f278e00969a6c44e9fd3c0feb5f11cc40c5de061cdea4cd813689dfbc1b63e2111",
		"45e91b9b76cd84477637bfbca07254e960cfb067d1921211e721514a15820e6e53afab293790108e37ac4d31b3963bd67828894ca6a3bbe7843a78fd4281f2b9",
		"37e0bb09fc6cbe62172e8865bc012a43cc9a11428b04b3654d55b99b0dab38e27237ca7aa44874c95837f17be9dc64bac080eaeecebeeaf945ffad6575f9f640",
		"be1cd955953c9bc4f66dfa153cfd970e37a66066f121e89f2b89c0fd84633d21d1f3d3f6e00d92f023556d5d8203b2e001a4ced934642d328a60901dbef9cd10",
		"863b0d174db12b82bbc51e8af96e6a2b14f405fcc24e950653cbe4a21afd0f47a78b3bb8b1b59c825ab607d17cb216ac7646d36b0e0df4f0015157d7be0e4239",
		"ff59a65e21e885e556c6c21297fad5a15781dc0a7969361ab55c689c9cdb9cac02bb37d6e6b608cf2c3d100d6278f97aa9bc68338b378c69a5ae5840379f8a94",
		"0b56d713026ee26d22542fb94760566dedd8b9049825432b32770a9b9f661144f10461975d8c571ecb62e1d01ed0caf2a6e17dd0148ce3c08839e8d94560bc85",
		"17eb3514c62a16db06d920706fba5b13e37d4b214d0fe7bcbbda8bd94f0fb76dfbd6fb33db7d2af30b6d29ffe090855b1e4739bfe8f5d2700beeb9ae7a03e064",
		"b7fba8b12e593225316214c494fb18a413384f2cc4699f5492db84d9e1512e3d126b8c93319d6d0c61140a2179de8ac01f519a3341d305c2babd05ad1856799c",
		"34d76aed0f6b8b474f2a39e39fae3cda0bc7621a748d846b65688f387367ffd871b3382c6439656b77f8293b8c51e776a6a9e57f4b00a499f808d24f4ca0a4aa",
		"e88953f0617fe19f855c5323402f0c26d46cdfd0374352695166590230a463aa63699af7367d91694144ffc34afe6b2c8356643004bb5d3f0177c12a8913e685",
		"d107ccbb4126362dbdd6d4ed118834a12efad1aa46ecfaba9603e2db4ca78917f47afbba20423987589191e34ed2cff9a2f300eaee680fc81c854283389bde29",
		"39a30097a799667b9a06d59c67bc4e03030bf1a893a2804e530dfaadb5ac528980d56b972a862eaf4b38d7fda51682bb0e23f624fa5c83496797889e2c527554",
		"b20d47c7a529f5023eb61ec649a768a8086cc14fa6b62ea8ad872fd648a372ccb44ddf49dc457bf2c91e17334c08ef37c08ca3a68a7f2e4cbc52b9ee5dfcfc9c",
		"74c6d37cb3d84fd4650e4b23a2fbd3b25714b8f8fbec5c6ec2b6a0430fd0ab46bee2af79663f67c220d2567db237d197f54d6a43a4c53a7d8cacd8960dee23ee",
	}, "")

	if ret := hex.EncodeToString(ret); ret != chk {
		t.Fatal(ret, chk)
	}
}

func TestPRF_TLS12_SHA256(t *testing.T) {
	label := []byte("LABEL")
	secret := []byte("SECRET")
	seed := []byte("SEED")

	prf := prf.New(tls.VersionTLS12, 0x009c) // TLS_RSA_WITH_AES_128_GCM_SHA256

	ret := make([]byte, 1024)
	prf(ret, secret, label, seed)

	chk := strings.Join([]string{
		"a80983a2a10561e29360743bcba12ea8fff65883e6572f8176f2eb09ea3fda3018f0b0b4a856f0660bae488f762846adecce2d4bc533b541411c2250dd179399",
		"176d791904961bc3e48177938429fb88ca68f81b4820ce42fa1ff342096d1fb5a0cf261fc667bde4c80c33c5e64005a96a6e0207df436931959555df2913c3f6",
		"4593d1a37384552b171d18c3be11de6dedd7357074164aa2a4b18a552a68dc5df530a21fd6563c9b3968221674013b98dedc51c74489ace761944331f69f56e8",
		"a18cbe21a63b6e5715a0eba3fb9994e1e407fd162003487c3b52d751812944c4a7a1de22c079a10bab0dae1ed14b2a98a62f3c8198199e902a3517729696ec10",
		"b930b8069a71bbd2fc728bdc2c0400aefbabae365d5f715215890bc101a262bdbb8b4c62e5e22b3c9092d13b5bf08723e50226e0911081d77fadae0937c39828",
		"5e4e4824299bb4513847ab8a555ccf639aa560a521e80b3764ed500435c64513919d6a07de13a08802d31596701ec37aa6a706aa43391e1bd138a622c4dbb8e9",
		"6ea96701a2237b9f43cce540c769308b2b4097bbb61d684e87abb0b2d0178769624441bae52d75d2148fb0a4ef5262cf1bdbaf1543604b960b9ff9a0b01ac8dc",
		"796a23ea1fd9ff1bce815a8baa908bccf39445095e6bfcaccfc4cf0f53c32a8ae9d55aae20440dbd42afc915196942cb675e847dcb244afa94061a9c4ed05c2e",
		"d4481a555fb9bbc6fd0a98d8e148588f7331d000b3ee5aaa60663f5a2c4f260256ab47c3cf048e714fcfdbc91075d4c8b66d7ef9f0a132e81b925647ddd9e33c",
		"b2aaba3455c301c40fe539bebab4799807ba600c8cb6aab54149cd319927f6c1b403d34bf26195d402631c9394ad8d7ba64a19326e2c8ce33b7d9653f7124eb6",
		"95966e62a7a2a98bddcd1d47ed94532ab25f656189fa9f9bb4d6fbb1013c6418c6648d7865ddc11abc3d984c6f38d300a63c7423de9aa5c8db0a837a46c7272c",
		"de79bd27cd56c76278cd2c91bcb3df34375093a7e2a63885c4b724dafe0e112a0410afcee781b412ac3ee9187d52f69434acfd1758bafe4b0f1260a1e6fdace0",
		"336fa7d316f7fa8190d660b5282918001d7d641eeafc41e985e0cd62917d82d92f419831c3dff91fc40425863c9fa6cb530712faea3a87ce4a4b3796154dc18c",
		"57ab1cfe7e1bf23c554138581bf7f48724dfb3cb4649dfbbbec78cc04ec32db5c181c5d6e214c65e653cbc3f19cff4748090987eaf079e93d254aa59f32b0b46",
		"601095b6dfc54bfdd252ee15ba414c8a1e84b52ea0047e94e250620f985615cb64052801cef00d85b9370f60de8c1105b908b1815b4044ec648417283159d6ad",
		"7585a207472dd5cfe6b8c57f8a6ffc07cc1e938bb4a49f86065924e92ca0f0a0c3888a71b23873d77e95c67ba0b4f9261635cdf633cf95774c221c1a520d94e8",
	}, "")

	if ret := hex.EncodeToString(ret); ret != chk {
		t.Fatal(ret, chk)
	}
}

func TestPRF_TLS12_SHA384(t *testing.T) {
	label := []byte("LABEL")
	secret := []byte("SECRET")
	seed := []byte("SEED")

	prf := prf.New(tls.VersionTLS12, 0x009d) // TLS_RSA_WITH_AES_256_GCM_SHA384

	ret := make([]byte, 1024)
	prf(ret, secret, label, seed)

	chk := strings.Join([]string{
		"c45b404b0d2ae28692af61589be6a0e1f499e343b1b91a30c3c16da8a63e124a57fc773a838a92cd24a94d0eba1dee7dbadf23899e599684f8d9b667d8f8026b",
		"d1ecc16a86030584104c4aff786f373ccf2137c05ee3966f9e37b9a0befbbe8208f0af7468c8d0a3764f232f47ec8c71c312dd9df193d101202cd074e0b28861",
		"3eae5a4440df63b74ba8d9836d76422d889f9c7a5347cd682441aa59ea19e8e9d5f6bbfa413826811c00352400bc91857c5c106871fa10a6fb02a4daa59db556",
		"4d17d533fb872e2869bda70f5d22b1f50662d17e062a6f3cd3539a3ccd2ae8daad0940da6ecfbb27ce2ec3377e423198adff8b5416d045cdba31c3b593f71f0a",
		"62439fc6e1fd5048fe7b8bd387c270d2b71bd13702f26e33a14eaec57dc8ae81159744febe10850b80e3b11d0d12e00f169293f79dfa321c751c308922040e6b",
		"5ed6a39ab9b2332b7d05927b5b9911fdefc85276f1f8097f23aa3b53766e78b0215d2fe1f330cff6661a17e32094bb291e1ef67b5c384c49eec057bd62bce5e1",
		"a84ee74dd69b1ff5062b8154027503b72ce3a8364bfe87ee442ba6674790e602da7cd798bff687aa9b0609c35c22c6be55b00dd3e0b4aab12d10b96c74f90928",
		"bd4b4c15b721691d7965861c409088fbc032ac1fea88e5ef05a6b843b0013d03aa65dd3a53b5aba0375f74644c72457a9396dfb3f8065072a7f56427fbfafe4a",
		"71ccf0924872f79c1ac30fc2f979b0333a5b3c93563ea01e0e2b05fbf0013d84e2e33335d5577c969fb62b8b88f9ece6cd3364695e2b7ccdad09198ffa4a69ac",
		"d234513430e66ee66366abca34db44959d488e52270bb0de9a1fb108c396783d9b3b0498f9d8f0f531a76a89cd8a0ad167997108f625d5f6d8cf6aca0589161c",
		"9dd11b837fd774998e9aac7c95fb27ad959c48fc18df4db45d087e2bc1985f60289593ccd2ba33675aea328ab266d3ee3f434ba63ec4beea04f4e98d9906ee3c",
		"2ec77e2994c143b48c50ff60a1d6a36b19f6dfb2174e07c29d97639b41e181062b2122e0c0501bad049640f7d6e2b245b4078b536813e52411bdcbfd29f85514",
		"dd0567f0ba913773801c31da72644e09f93d28a37a37520f98530cee39944c00991273a61c91b7b9883d6d1087aca49c79dc547dd78148afc12962bf9b6ee16a",
		"e685b3823fc7dec73b554bb8baafe262cd1a5468f5ab8e5c927b54af6bcdc572bc1ea2a619306275b4e858470fdecdd88c15850668c76648612c29e9014a3ae4",
		"58ac3ff910ed67bc7636a1f93dd54a2180795498d7ba69fe008b702aac6b8a56f6f94e7fe20987175566c4e1be4cd1dc44bc738fd1e5a99e8b092c20bc49544b",
		"f7ece54b6c7adf2ddad9a061c1b3dfa18043afa62b757ebca12b9185ab7867aab0617612f60593d2b9c5d926856989324a39d1e79829d8262911261795cc8249",
	}, "")

	if ret := hex.EncodeToString(ret); ret != chk {
		t.Fatal(ret)
	}
}
